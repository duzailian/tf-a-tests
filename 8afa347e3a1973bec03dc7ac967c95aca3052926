{
  "comments": [
    {
      "key": {
        "uuid": "2a8e1a0d_fad8ded4",
        "filename": "tftf/framework/timer/timer_framework.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2018-11-06T13:38:22Z",
      "side": 0,
      "message": "I might have missed the rationale for this patch...\n\nAs far as I understand, the only piece of platform-specific information here is the base address of the timer frame.  And as a matter of fact, SYS_CNT_BASE1 is a platform macro at the moment (and for that reason it should probably be renamed into PLAT_SYS_CNT_BASE or similar).\n\nApart from that, this piece of code just reads the Generic Timer memory-mapped registers, which are architecturally defined (see section I2.3 in the Arm Arm, rev D.a) so this does not look specific to Arm platforms to me.\n\nCould you please explain what was the exact problem you faced?",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 64,
        "endChar": 1
      },
      "revId": "8afa347e3a1973bec03dc7ac967c95aca3052926",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d5eae33f_71811a61",
        "filename": "tftf/framework/timer/timer_framework.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2018-11-06T13:47:58Z",
      "side": 0,
      "message": "The first sentence in I2.3 makes it clear that the memory mapped registers are optional, so I think it is correct to move the whole function to the platform: \"This part of the ARM Generic Timer specification defines an optional memory-mapped timer component.\"",
      "parentUuid": "2a8e1a0d_fad8ded4",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 64,
        "endChar": 1
      },
      "revId": "8afa347e3a1973bec03dc7ac967c95aca3052926",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ccbb41a_d170e538",
        "filename": "tftf/framework/timer/timer_framework.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2018-11-12T14:29:28Z",
      "side": 0,
      "message": "The Arm ARM indeed says that the *memory-mapped timers* are optional but the *memory-mapped counter module* is required and as far as I understand, that\u0027s all we need to measure time here.\n\nIt seems to me that we could simply read the CNTCV (Counter Count Value) memory-mapped register to implement this function in a generic manner. Alternatively we could use the system register interface (MSR/MRS) and read the CNTPCT_EL0 (Counter-timer Physical Count) register, which I think is equivalent (TBC).\n\nThen I think we should move this function to the drivers/ layer.\n\nThe system *timer* is another matter and as John pointed out, some platforms might use a timer IP that does not expose a Generic Timer interface, like Juno (which uses SP804) or Hikey960 as it seems. But as far as I can see, platform ports can already override the system timer callbacks through the plat_initialise_timer_ops() function so I think we\u0027re good on this front.",
      "parentUuid": "d5eae33f_71811a61",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 64,
        "endChar": 1
      },
      "revId": "8afa347e3a1973bec03dc7ac967c95aca3052926",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "771f25f6_61d89192",
        "filename": "tftf/framework/timer/timer_framework.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2018-11-12T14:40:22Z",
      "side": 0,
      "message": "\u003e The Arm ARM indeed says that the *memory-mapped timers* are\n\u003e optional but the *memory-mapped counter module* is required\n\u003e and as far as I understand, that\u0027s all we need to measure\n\u003e time here.\n\nIn I2.1 it says \"This memory-mapped counter module is required in any ARM Generic Timer implementation that requires software control of the Count value of the Generic Timer.\"\n\nI understand that it is still optional if you don\u0027t need to access the generic timer registers from software, and I assume this is the case in Hikey960 (and GXBB).\n\nAnd, even if you do have it, the documentation of your platform may not have the address of it (it may consider it unnecessary if there are other timers in the system). We can\u0027t rely on it being there.\n\nIt could be moved to drivers, but this is still a platform interface. If we think that drivers can implement platform interfaces, then fine, but I don\u0027t think that\u0027s the right thing to do. If needed, a platform interface would call the driver function for this driver, but that seems overkill for something this simple (and it can always be done in the future if this is a platform interface).",
      "parentUuid": "6ccbb41a_d170e538",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 64,
        "endChar": 1
      },
      "revId": "8afa347e3a1973bec03dc7ac967c95aca3052926",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c35ef4ab_b85ba25a",
        "filename": "tftf/framework/timer/timer_framework.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2018-11-12T14:56:13Z",
      "side": 0,
      "message": "\u003e In I2.1 it says \"This memory-mapped counter module is required in\n \u003e any ARM Generic Timer implementation that requires software control\n \u003e of the Count value of the Generic Timer.\"\n \u003e \n \u003e I understand that it is still optional if you don\u0027t need to access\n \u003e the generic timer registers from software, and I assume this is the\n \u003e case in Hikey960 (and GXBB).\n\nSo that might be the difference between the memory-mapped interface and the system register interface. I think the system register interface (CNTPCT_EL0 register) might still be mandatory, as I do not see anything in section D12.8.19 that might suggest this register might not be implemented.",
      "parentUuid": "771f25f6_61d89192",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 64,
        "endChar": 1
      },
      "revId": "8afa347e3a1973bec03dc7ac967c95aca3052926",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae397e41_2d6c80ff",
        "filename": "tftf/framework/timer/timer_framework.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2018-11-12T15:05:51Z",
      "side": 0,
      "message": "I thought the register-based timer interface was per-CPU, not per-system.",
      "parentUuid": "c35ef4ab_b85ba25a",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 64,
        "endChar": 1
      },
      "revId": "8afa347e3a1973bec03dc7ac967c95aca3052926",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    }
  ]
}