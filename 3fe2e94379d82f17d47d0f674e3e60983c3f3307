{
  "comments": [
    {
      "key": {
        "uuid": "fff321de_d45879a8",
        "filename": "Makefile",
        "patchSetId": 3
      },
      "lineNbr": 211,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-02-28T16:49:04Z",
      "side": 1,
      "message": "Why limit this to leaf functions? What if a test function is a leaf? Would that not defeat the purpose of this approach?",
      "range": {
        "startLine": 211,
        "startChar": 16,
        "endLine": 211,
        "endChar": 46
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7953715_31d93906",
        "filename": "Makefile",
        "patchSetId": 3
      },
      "lineNbr": 211,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-01T09:45:12Z",
      "side": 1,
      "message": "Even if leaf functions are not tested, the key is used everywhere else. If the wrong key is in the registers when returning from EL3, it will crash as soon as leaving any function.\n\nAlso, this compiler option will change with BTI. It is deprecated in GCC 9.",
      "parentUuid": "fff321de_d45879a8",
      "range": {
        "startLine": 211,
        "startChar": 16,
        "endLine": 211,
        "endChar": 46
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "77efde26_4df55045",
        "filename": "docs/porting-guide.rst",
        "patchSetId": 3
      },
      "lineNbr": 376,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-02-28T16:49:04Z",
      "side": 1,
      "message": "I\u0027m having second thoughts about adding this paragraph. AFAIK, we do not use Pointer Authentication for the purpose of protecting the TFTF binary from ROP attacks and such. We just want some test payload that makes use of it and see whether this affects TF-A. In this context, we don\u0027t really care whether the authentication keys we choose for TFTF are random or not, this should not make any difference to TF-A.\n\nI\u0027d rather remove this paragraph to not create any confusion about the purpose of enabling Pointer Authentication in TFTF.",
      "range": {
        "startLine": 375,
        "startChar": 0,
        "endLine": 376,
        "endChar": 77
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a289ae4d_fed29969",
        "filename": "docs/porting-guide.rst",
        "patchSetId": 3
      },
      "lineNbr": 376,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-01T09:45:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "77efde26_4df55045",
      "range": {
        "startLine": 375,
        "startChar": 0,
        "endLine": 376,
        "endChar": 77
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1071e032_59f80bdf",
        "filename": "docs/user-guide.rst",
        "patchSetId": 3
      },
      "lineNbr": 39,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-02-28T16:49:04Z",
      "side": 1,
      "message": "We might want to add a note here to explain that GCC 8 (right?) is needed for Pointer Authentication support.",
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7850126_b38c6e04",
        "filename": "docs/user-guide.rst",
        "patchSetId": 3
      },
      "lineNbr": 39,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-01T09:45:12Z",
      "side": 1,
      "message": "This is going to change before the 2.1 release so I\u0027d rather wait until then. PAuth was introduced in GCC 7 anyway.",
      "parentUuid": "1071e032_59f80bdf",
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "82cf56c4_7a1f3bf0",
        "filename": "docs/user-guide.rst",
        "patchSetId": 3
      },
      "lineNbr": 342,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-02-28T16:49:04Z",
      "side": 1,
      "message": "I don\u0027t believe this is a build option shared across all test images, is it? I thought it was specific to TFTF, in which case it should be moved to the next section of this document.\n\nAlso, it might be worth calling out that only recent GCC versions support the -msign-return-address option.",
      "range": {
        "startLine": 339,
        "startChar": 0,
        "endLine": 342,
        "endChar": 47
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1e420605_b9d74926",
        "filename": "docs/user-guide.rst",
        "patchSetId": 3
      },
      "lineNbr": 342,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-01T09:45:12Z",
      "side": 1,
      "message": "Well, recent versions of GCC support it, and even newer don\u0027t. I\u0027d rather not give any numbers here, this is going to change soon when BTI support is added.",
      "parentUuid": "82cf56c4_7a1f3bf0",
      "range": {
        "startLine": 339,
        "startChar": 0,
        "endLine": 342,
        "endChar": 47
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "38c0b789_3344565f",
        "filename": "plat/common/aarch64/pauth.c",
        "patchSetId": 3
      },
      "lineNbr": 16,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-02-28T16:49:04Z",
      "side": 1,
      "message": "Does the platform need to be responsible for allocating this key buffer? Can we not move it to generic code and pass it to plat_init_apiakey() for the platform layer to initialize? What\u0027s the use case for a platform to be able to define its own key buffer?",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 16,
        "endChar": 60
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "986e6a00_480b34e0",
        "filename": "plat/common/aarch64/pauth.c",
        "patchSetId": 3
      },
      "lineNbr": 16,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-01T09:45:12Z",
      "side": 1,
      "message": "The platform may not want to put this in rodata, for example. I\u0027d like to keep this as a copy of the file in the TF if possible so that it is straightforward to share code.",
      "parentUuid": "38c0b789_3344565f",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 16,
        "endChar": 60
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "561c538e_c8643793",
        "filename": "plat/common/aarch64/pauth.c",
        "patchSetId": 3
      },
      "lineNbr": 21,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-02-28T16:49:04Z",
      "side": 1,
      "message": "In line with my other comment in the porting guide, this sentence seems a bit off to me. TFTF is not meant to be present on a production system. Suggest dropping it.",
      "range": {
        "startLine": 20,
        "startChar": 27,
        "endLine": 21,
        "endChar": 54
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "924538f3_0cd81c59",
        "filename": "plat/common/aarch64/pauth.c",
        "patchSetId": 3
      },
      "lineNbr": 21,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-01T09:45:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "561c538e_c8643793",
      "range": {
        "startLine": 20,
        "startChar": 27,
        "endLine": 21,
        "endChar": 54
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "59652ac3_afbcb409",
        "filename": "tftf/framework/main.c",
        "patchSetId": 3
      },
      "lineNbr": 527,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-02-28T16:49:04Z",
      "side": 1,
      "message": "At least we could move this new code to a static inline function in this file, that would hide the pollution introduced by the #if ENABLE_PAUTH and avoid adding too much code in tftf_cold_boot_main().",
      "range": {
        "startLine": 523,
        "startChar": 0,
        "endLine": 527,
        "endChar": 4
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5528322c_9eca86a5",
        "filename": "tftf/framework/main.c",
        "patchSetId": 3
      },
      "lineNbr": 527,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-01T09:45:12Z",
      "side": 1,
      "message": "PAuth can\u0027t be enabled inside of a function or it will fail the authentication when returning. Right now, with non-leaf it could be possible, but if the compiler\u0027s behaviour changes (and it will probably change with 8.5 BTI) it would lead to a non-obvious crash.\n\nI\u0027d also like to keep all this code together, so I decided to keep it here.",
      "parentUuid": "59652ac3_afbcb409",
      "range": {
        "startLine": 523,
        "startChar": 0,
        "endLine": 527,
        "endChar": 4
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3199be27_558fb6b6",
        "filename": "tftf/framework/main.c",
        "patchSetId": 3
      },
      "lineNbr": 527,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-03-01T13:24:42Z",
      "side": 1,
      "message": "\u003e PAuth can\u0027t be enabled inside of a function\n\nThat\u0027s why I was suggesting an *inline* function. AFAICS, that\u0027s what they are proposing to do in the Linux kernel:\n\nhttps://lore.kernel.org/patchwork/patch/995779/\n\n\u003e Right now, with non-leaf it could be possible, but if the compiler\u0027s behaviour changes (and it will probably change with 8.5 BTI) it would lead to a non-obvious crash.\n\nAbsolutely, I was not suggesting we do that. I agree with you, relying on this function to be a leaf one would be very fragile.",
      "parentUuid": "5528322c_9eca86a5",
      "range": {
        "startLine": 523,
        "startChar": 0,
        "endLine": 527,
        "endChar": 4
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "75119a97_d4aa1fc2",
        "filename": "tftf/framework/main.c",
        "patchSetId": 3
      },
      "lineNbr": 527,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-04T13:41:11Z",
      "side": 1,
      "message": "\u003e That\u0027s why I was suggesting an *inline* function. AFAICS,\n\u003e that\u0027s what they are proposing to do in the Linux kernel:\n\nIn practice, using an always_inline function would work. In theory, that obscures the problem and someone may move that call somewhere else in the future, inside another non-inline function, for example. After all, it will just be a function call.",
      "parentUuid": "3199be27_558fb6b6",
      "range": {
        "startLine": 523,
        "startChar": 0,
        "endLine": 527,
        "endChar": 4
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fe5d58e1_bb16c16a",
        "filename": "tftf/framework/main.c",
        "patchSetId": 3
      },
      "lineNbr": 527,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-03-04T13:47:12Z",
      "side": 1,
      "message": "\u003e In practice, using an always_inline function would work. In theory,\n \u003e that obscures the problem and someone may move that call somewhere\n \u003e else in the future, inside another non-inline function, for\n \u003e example. After all, it will just be a function call.\n\nI disagree, I don\u0027t think an always-inline function is more obscure than the solution proposed in this patch. Someone might equally move the code from tftf_cold_boot_main() somewhere else, inside a non-inline function. The way we ensure this does not happen is through code documentation, like you\u0027ve done in this patch.",
      "parentUuid": "75119a97_d4aa1fc2",
      "range": {
        "startLine": 523,
        "startChar": 0,
        "endLine": 527,
        "endChar": 4
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e7fb6b3e_5d0f0130",
        "filename": "tftf/framework/main.c",
        "patchSetId": 3
      },
      "lineNbr": 527,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-04T14:55:51Z",
      "side": 1,
      "message": "The problem is that inlining functions is usually done because of optimization purposes, not because it is actually needed or the system will crash. The code needs to be predictable, and relying on always_inline is quite obscure to me. Having the code explicitly outside of the function is more clear.",
      "parentUuid": "fe5d58e1_bb16c16a",
      "range": {
        "startLine": 523,
        "startChar": 0,
        "endLine": 527,
        "endChar": 4
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "211d2c45_6a14376e",
        "filename": "tftf/framework/main.c",
        "patchSetId": 3
      },
      "lineNbr": 529,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-02-28T16:49:04Z",
      "side": 1,
      "message": "Why do we limit this to the ID_AA64ISAR1_EL1.API bit? In other words, why does Pointer authentication have to be implemented via an implementation defined algorithm? Why is the architected algorithm (APA bit) not suitable here?",
      "range": {
        "startLine": 529,
        "startChar": 1,
        "endLine": 529,
        "endChar": 40
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "66121961_756f6d33",
        "filename": "tftf/framework/main.c",
        "patchSetId": 3
      },
      "lineNbr": 529,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-01T09:45:12Z",
      "side": 1,
      "message": "I needed to check both.",
      "parentUuid": "211d2c45_6a14376e",
      "range": {
        "startLine": 529,
        "startChar": 1,
        "endLine": 529,
        "endChar": 40
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "841580ad_869e57f9",
        "filename": "tftf/framework/main.c",
        "patchSetId": 3
      },
      "lineNbr": 529,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2019-03-01T13:15:42Z",
      "side": 1,
      "message": "https://github.com/ARM-software/arm-trusted-firmware/pull/1851",
      "parentUuid": "66121961_756f6d33",
      "range": {
        "startLine": 529,
        "startChar": 1,
        "endLine": 529,
        "endChar": 40
      },
      "revId": "3fe2e94379d82f17d47d0f674e3e60983c3f3307",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    }
  ]
}