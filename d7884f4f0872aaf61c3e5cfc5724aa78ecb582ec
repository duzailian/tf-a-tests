{
  "comments": [
    {
      "key": {
        "uuid": "eb052715_ac302361",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2020-09-21T16:39:36Z",
      "side": 1,
      "message": "are we sure about this? if scr_el3.fiq bit is set, does it really go to S-EL2?",
      "range": {
        "startLine": 9,
        "startChar": 53,
        "endLine": 10,
        "endChar": 6
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3a0de3c7_6920037b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000098
      },
      "writtenOn": "2020-09-21T21:48:39Z",
      "side": 1,
      "message": "I have a question on similar lines. Are both secure and non-secure interrupts trapped to higher EL?",
      "parentUuid": "eb052715_ac302361",
      "range": {
        "startLine": 9,
        "startChar": 53,
        "endLine": 10,
        "endChar": 6
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dce2c333_eb1ddae0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2020-09-22T00:53:48Z",
      "side": 1,
      "message": "Yes, depending on SCR_EL3.FIQ/IRQ bits. At-least today, typically Group0 and Group1 NS interrupts are routed to EL3(platform selectable, but typically what i have seen). Perhaps for hafnium in secure world, there is a plan in SPMD to change routing model and route all those interrupts to S-EL2, which i\u0027m not aware of..",
      "parentUuid": "3a0de3c7_6920037b",
      "range": {
        "startLine": 9,
        "startChar": 53,
        "endLine": 10,
        "endChar": 6
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "79529202_4a0bee04",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000098
      },
      "writtenOn": "2020-09-22T13:41:27Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "dce2c333_eb1ddae0",
      "range": {
        "startLine": 9,
        "startChar": 53,
        "endLine": 10,
        "endChar": 6
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cdafb63b_0eee016c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2020-09-22T14:05:54Z",
      "side": 1,
      "message": "Similar to SCR_EL3.FIQ/IRQ bits, HCR_EL2.FIQ/IRQ can be configured.\n\nThere is difference in interrupt trapping in case of hafnium(EL2) and SPM(S-EL2)\n\nIn normal world while running VMs \nWhen primary VM is running NS interrupts are directly handled in PVM which owns the GIC at NS-EL1, if secondary VM is running then it gets trapped into hafnium(EL2) and switch to PVM which does delegates it to corresponding VM.\n\nHowever in case of SPM(S-EL2) there is no primary SP(vm) concept and all NS interrupts are trapped in SPM.\nSPM then injects virtual interrupts in S-EL1 payload(cactus in this case).\n\nIn hafnium hcr_el2.IMO/FMO has different values for Primary and secondary while in SPM they are same.",
      "parentUuid": "dce2c333_eb1ddae0",
      "range": {
        "startLine": 9,
        "startChar": 53,
        "endLine": 10,
        "endChar": 6
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "272d5c41_375d4290",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2020-09-22T14:53:24Z",
      "side": 1,
      "message": "I understand that there is no PVM in hafnium in S-EL2. Also agree there is HCR_EL2 but SCR_EL3 takes priority over HCR_EL2 settings and the interrupts will trap to EL3 if the SCR_EL3.FIQ/IRQ is set.\nIs there going to be an accompanying change in SPMD that changes the routing model to enable interrupts to trap to EL3?\n\nMy question comes from the wording in the commit message, which says that interrupts trap to S-EL2. Strictly, that may not be the case due to SCR_EL3 settings, so maybe it may need to be worded to say that interrupts trap to EL3 or S-EL2 and then injected into the SP.",
      "parentUuid": "cdafb63b_0eee016c",
      "range": {
        "startLine": 9,
        "startChar": 53,
        "endLine": 10,
        "endChar": 6
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e377ed9_d96f1d2d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2020-09-22T15:49:11Z",
      "side": 1,
      "message": "SCR_EL3.FIQ/IRQ state is setup by the SPD, here SPMD.\nThe default when SPD does not update those bits is SCR_EL3.IRQ/FIQ\u003d0 whichever running NWd or SWd. This will soon change to this setup done by the SPMD init:\nSCR_EL3.IRQ\u003d0/FIQ\u003d1 while running NWd.\nSCR_EL3.IRQ\u003d0/FIQ\u003d0 while running SWd.\n\nIt means in NWd, Grp1S and Group0 are trapped to EL3. Grp1S are further routed to S-EL2 by the SPMD.\nIn the SWd, Grp1NS and Group0 are trapped to S-EL2. Both may trigger an optional managed exit to the currently running SP, and then exit to EL3. Group0 interrupts are handled at EL3. Grp1NS interrupt cause an exit to NWd.\n\nI will publish our initial thoughts regards interrupts handling in an SPM doc review, and we can follow up there.",
      "parentUuid": "272d5c41_375d4290",
      "range": {
        "startLine": 9,
        "startChar": 53,
        "endLine": 10,
        "endChar": 6
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ff073d9e_91a8edb0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2020-09-22T17:24:46Z",
      "side": 1,
      "message": "I removed the details of interrupt handling from this patch and kept it minimal information about what this patch does.",
      "parentUuid": "8e377ed9_d96f1d2d",
      "range": {
        "startLine": 9,
        "startChar": 53,
        "endLine": 10,
        "endChar": 6
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "412e4cfb_c38b2dba",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2020-09-22T17:28:32Z",
      "side": 1,
      "message": "@Olivier, thanks. That was exactly my point. New commit message looks good. Resolving.",
      "parentUuid": "ff073d9e_91a8edb0",
      "range": {
        "startLine": 9,
        "startChar": 53,
        "endLine": 10,
        "endChar": 6
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5686c708_f78db61d",
        "filename": "spm/common/sp_helpers.h",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2020-09-22T15:58:25Z",
      "side": 1,
      "message": "0xFF04 with upstream Hafnium",
      "range": {
        "startLine": 20,
        "startChar": 41,
        "endLine": 20,
        "endChar": 47
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fbc47179_01b99ca8",
        "filename": "spm/common/sp_helpers.h",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2020-09-22T17:24:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5686c708_f78db61d",
      "range": {
        "startLine": 20,
        "startChar": 41,
        "endLine": 20,
        "endChar": 47
      },
      "revId": "d7884f4f0872aaf61c3e5cfc5724aa78ecb582ec",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    }
  ]
}