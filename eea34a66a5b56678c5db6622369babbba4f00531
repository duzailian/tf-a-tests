{
  "comments": [
    {
      "key": {
        "uuid": "dda37713_e7c79430",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 78,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2018-12-12T10:36:21Z",
      "side": 1,
      "message": "Why not put the dependency on the DTS on the same line?",
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "21da675f_33bc5721",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 78,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2018-12-12T10:42:00Z",
      "side": 1,
      "message": "I didn\u0027t want to go over 80 characters.",
      "parentUuid": "dda37713_e7c79430",
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cd64fa59_8ef159b9",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 79,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2018-12-12T10:36:21Z",
      "side": 1,
      "message": "There still seems to be a dependency issue because the DTB file is sometimes re-generated when it shouldn\u0027t. This could perhaps hide an issue.\n\nFor example, if I:\n1. clean (make distclean) my tree\n2. build cactus (make cactus), the DTB is generated, as expected.\n3. make cactus again, no source file is recompiled but the DTB is. This behaviour seems incorrect to me.\n4. make cactus one last time, nothing to be done, as expected.\n\nOff the top of my head, I can\u0027t see what\u0027s causing this spurious generation of the DTB at step 3...",
      "range": {
        "startLine": 79,
        "startChar": 0,
        "endLine": 79,
        "endChar": 37
      },
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "59bb3c6c_a15c80a5",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 79,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2018-12-12T10:42:00Z",
      "side": 1,
      "message": "I can\u0027t reproduce this problem. In my setup the only thing that is rebuilt every time with ``make all`` is the el3_payload target.",
      "parentUuid": "cd64fa59_8ef159b9",
      "range": {
        "startLine": 79,
        "startChar": 0,
        "endLine": 79,
        "endChar": 37
      },
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b367de15_23754d6a",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 79,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2018-12-12T12:58:45Z",
      "side": 1,
      "message": "Have you cleaned your build tree before trying to run \u0027make all\u0027? It seems to me that the issue is related to the build directory itself. In the output of make -d, I read the following lines the second time I try to build:\n\n Prerequisite \u0027build/fvp/debug/cactus\u0027 is newer than target \u0027build/fvp/debug/cactus.dtb\u0027. \n \u003csnip\u003e\n Must remake target \u0027build/fvp/debug/cactus.dtb\u0027.",
      "parentUuid": "59bb3c6c_a15c80a5",
      "range": {
        "startLine": 79,
        "startChar": 0,
        "endLine": 79,
        "endChar": 37
      },
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "02e2f985_52219fae",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 79,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2018-12-12T13:34:54Z",
      "side": 1,
      "message": "Ok, I\u0027ve been able to do this (I was using -j to build it, and it looks like that was hiding the problem). It looks to me like the problem is that this depends on the folder cactus and cactus/cactus.elf. However, if I remove the folder from dependencies it doesn\u0027t even build. If I keep it, it builds but it shows this problem. I don\u0027t know what to do in this case.\n\nThe main problem is the MAKE_IMG macro of the top Makefile. I\u0027ve had to hook the RD blob generation in a not-too-clean way.",
      "parentUuid": "b367de15_23754d6a",
      "range": {
        "startLine": 79,
        "startChar": 0,
        "endLine": 79,
        "endChar": 37
      },
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "68586679_d626452f",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 79,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2018-12-13T08:52:58Z",
      "side": 1,
      "message": "So the problem is that the files inside the folder are modified after the elf file is created, so the DTB is created before the last file created in the folder. This makes \"make\" think that the folder has changed and so the DTB target is old. I don\u0027t think this can be fixed without more changes to the build system.",
      "parentUuid": "02e2f985_52219fae",
      "range": {
        "startLine": 79,
        "startChar": 0,
        "endLine": 79,
        "endChar": 37
      },
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e42c398_8ddf8d52",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 79,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2018-12-13T09:59:54Z",
      "side": 1,
      "message": "I think we solve this issue in TF-A with \"order-only prerequisites\" [1] on the build directory. This ensures that the build directory is the first thing that is created, even before the other \"normal\" dependencies of a rule.\n\nCan we not do the same here?\n\n[1] https://git.trustedfirmware.org/TF-A/trusted-firmware-a.git/tree/make_helpers/build_macros.mk#n383",
      "parentUuid": "68586679_d626452f",
      "range": {
        "startLine": 79,
        "startChar": 0,
        "endLine": 79,
        "endChar": 37
      },
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a0fc01ef_652c0215",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 79,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2018-12-13T11:27:08Z",
      "side": 1,
      "message": "I\u0027ve tried:\n\n```\n$(CACTUS_DTB) : | $(BUILD_PLAT)/cactus\n$(CACTUS_DTB) : $(BUILD_PLAT)/cactus/cactus.elf spm/cactus/cactus.dts\n```\n\nIt doesn\u0027t fix it, and it creates problems (missing dependencies). Any idea? We could always fix this in a following patch, this is not a big problem like a missing dependency.",
      "parentUuid": "4e42c398_8ddf8d52",
      "range": {
        "startLine": 79,
        "startChar": 0,
        "endLine": 79,
        "endChar": 37
      },
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af3596de_becf57d5",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 88,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2018-12-12T10:36:21Z",
      "side": 1,
      "message": "Why not put the DTB dependency on this line?",
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bae1eaaf_8310fd0f",
        "filename": "spm/cactus/cactus.mk",
        "patchSetId": 12
      },
      "lineNbr": 88,
      "author": {
        "id": 1000050
      },
      "writtenOn": "2018-12-12T10:42:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "af3596de_becf57d5",
      "revId": "eea34a66a5b56678c5db6622369babbba4f00531",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    }
  ]
}