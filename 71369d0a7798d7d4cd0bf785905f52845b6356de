{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "444f30ce_55f6b1cf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2023-11-28T17:20:47Z",
      "side": 1,
      "message": "Just a heads up, We are looking to merge these patches in the next couple of days.",
      "revId": "71369d0a7798d7d4cd0bf785905f52845b6356de",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dda14f95_87ac3afc",
        "filename": "spm/cactus/cactus_tests/cactus_test_interrupts.c",
        "patchSetId": 1
      },
      "lineNbr": 259,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2023-11-28T14:18:40Z",
      "side": 1,
      "message": "I think this is slightly wrong because this isn\u0027t about an FF-A call but a platform SiP SMC call.",
      "range": {
        "startLine": 259,
        "startChar": 1,
        "endLine": 259,
        "endChar": 40
      },
      "revId": "71369d0a7798d7d4cd0bf785905f52845b6356de",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5c3e01ca_35b70c8e",
        "filename": "spm/cactus/cactus_tests/cactus_test_interrupts.c",
        "patchSetId": 1
      },
      "lineNbr": 259,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2023-11-28T14:40:22Z",
      "side": 1,
      "message": "hmm, that can be done separately as this is not a problem introduced in this patch ?",
      "parentUuid": "dda14f95_87ac3afc",
      "range": {
        "startLine": 259,
        "startChar": 1,
        "endLine": 259,
        "endChar": 40
      },
      "revId": "71369d0a7798d7d4cd0bf785905f52845b6356de",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "53a6d3d4_172de0e9",
        "filename": "spm/cactus/cactus_tests/cactus_test_interrupts.c",
        "patchSetId": 1
      },
      "lineNbr": 259,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2023-11-28T14:44:34Z",
      "side": 1,
      "message": "At this call site, it was using tftf_smc and not ffa_service_call for this reason.\nI agree it may work like this but looks semantically incorrect.",
      "parentUuid": "5c3e01ca_35b70c8e",
      "range": {
        "startLine": 259,
        "startChar": 1,
        "endLine": 259,
        "endChar": 40
      },
      "revId": "71369d0a7798d7d4cd0bf785905f52845b6356de",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3f26094_7af400db",
        "filename": "spm/cactus/cactus_tests/cactus_test_interrupts.c",
        "patchSetId": 1
      },
      "lineNbr": 259,
      "author": {
        "id": 1000098
      },
      "writtenOn": "2023-11-28T15:46:57Z",
      "side": 1,
      "message": "I agree with Olivier. This is a platform specific SMC call and not an FF-A ABI.",
      "parentUuid": "53a6d3d4_172de0e9",
      "range": {
        "startLine": 259,
        "startChar": 1,
        "endLine": 259,
        "endChar": 40
      },
      "revId": "71369d0a7798d7d4cd0bf785905f52845b6356de",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd7f1aba_ebc2153b",
        "filename": "spm/cactus/cactus_tests/cactus_test_interrupts.c",
        "patchSetId": 1
      },
      "lineNbr": 259,
      "author": {
        "id": 1000390
      },
      "writtenOn": "2023-11-28T17:17:25Z",
      "side": 1,
      "message": "\u003e ... This is a platform specific SMC call and not an FF-A ABI.\n\nI had to add this fix to progress on SVE hint bit support patches. As with the SVE hint support, tftf_smc will set SMC.FID[16] to 1 if CPU supports SVE and SVE traps are set in CPTR_EL2/CPACR_EL1 register to denote absence of live sve state.\n\nUsing tftf_smc, this failure is seen\n\n\u003e Executing \u0027Test ESPI Secure interrupt handling\u0027\nNOTICE: SMC 0x82010100 attempted from VM 0x8001, blocked\u003d1\nERROR:   Interrupt 5000 not serviced by SP\n  TEST COMPLETE                                                 Failed\n\nNow it looks like the best place to fix this is in Hafnium, to discard sve hint bit as part of function identification.\n\n``` c\n+++ b/src/arch/aarch64/hypervisor/handler.c\n@@ -829,6 +829,13 @@ static struct vcpu *smc_handler(struct vcpu *vcpu)\n       struct ffa_value args \u003d arch_regs_get_args(\u0026vcpu-\u003eregs);\n       struct vcpu *next \u003d NULL;\n\n+       /*\n+        * Discard SVE hint bit from function identification. We don\u0027t have to\n+        * preserve this flag as Secure partitions do not support SVE.\n+        */\n+       args.func \u0026\u003d ~(1 \u003c\u003c 16);\n+\n       if (hvc_smc_handler(args, vcpu, \u0026next)) {\n\n``` c\n\nLet me know your thoughts?",
      "parentUuid": "b3f26094_7af400db",
      "range": {
        "startLine": 259,
        "startChar": 1,
        "endLine": 259,
        "endChar": 40
      },
      "revId": "71369d0a7798d7d4cd0bf785905f52845b6356de",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7ad51ac_10d29f4e",
        "filename": "spm/cactus/cactus_tests/cactus_test_interrupts.c",
        "patchSetId": 1
      },
      "lineNbr": 259,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2023-11-28T17:20:04Z",
      "side": 1,
      "message": "Or the other alternative is introduce another tftf helper \"tftf_smc_base()\" just for the purpose of this failing case and once hafnium fixes the issue, this can be removed. \n\n\nPlease let us know of your preference.",
      "parentUuid": "cd7f1aba_ebc2153b",
      "range": {
        "startLine": 259,
        "startChar": 1,
        "endLine": 259,
        "endChar": 40
      },
      "revId": "71369d0a7798d7d4cd0bf785905f52845b6356de",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e0fdbff_03291a08",
        "filename": "spm/cactus/cactus_tests/cactus_test_interrupts.c",
        "patchSetId": 1
      },
      "lineNbr": 259,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2023-11-28T17:29:57Z",
      "side": 1,
      "message": "\u003e Now it looks like the best place to fix this is in Hafnium, to discard sve hint bit as part of function identification.\n\nThis looks reasonable but to be pedantic secure partitions do not support SVE and hence have no reason to set the SVE hint bit. Hafnium returning through a controlled error path is not necessarily an issue there.\n\n\u003e Or the other alternative is introduce another tftf helper \"tftf_smc_base()\n\nWe could redefine tftf_smc in context of cactus framework, instead of importing a TFTF function into the cactus framework.\n\nI\u0027ll let Joao/Madhu decide the best course of action.",
      "parentUuid": "a7ad51ac_10d29f4e",
      "range": {
        "startLine": 259,
        "startChar": 1,
        "endLine": 259,
        "endChar": 40
      },
      "revId": "71369d0a7798d7d4cd0bf785905f52845b6356de",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}