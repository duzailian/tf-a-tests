{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "21a5a994_9f3791ff",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-10-31T14:58:44Z",
      "side": 1,
      "message": "Not entirely correct as PMU is expected to be disabled on entry to Secure world but not the realm world. Could mention that here.",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 9,
        "endChar": 61
      },
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "314b35f9_9f6aceb3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-14T12:05:23Z",
      "side": 1,
      "message": "I don\u0027t understand. This sentence is as generic as possible, why does this matter? Regardless, whether the PMU works or not outside NS is out of scope for these patches. That\u0027s kind of the whole point and I think \"regardless of what EL3 decides to do\" outlines this?",
      "parentUuid": "21a5a994_9f3791ff",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 9,
        "endChar": 61
      },
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae9e5992_50aa285f",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-10-31T14:58:44Z",
      "side": 1,
      "message": "This test is assuming TSP which may not be the case going forward for Newmore. Would prefer the test to be written with FF-A.",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "78d52387_dea8b6b5",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-14T12:05:23Z",
      "side": 1,
      "message": "It does assume TSP but it also checks for it before each test, as a few others do. Even if TSP disappeared this wouldn\u0027t break. \n\nI could implement it, but this would be the first such test. My proposal is consistent with the other tests. Is there somewhere a test I can use as a starting point? Alternatively, could you point me to the documentation?\n\nIs this a general thing that needs doing? MTE and PAUTH tests also do this.",
      "parentUuid": "ae9e5992_50aa285f",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b6c42d0c_01ff5869",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-11-22T17:48:32Z",
      "side": 1,
      "message": "OK, I think going forward, you should use FF-A compatible Secure SMC calls for the tests. TSP is only for 2 worlds tests and will not be present in 4 worlds configs.\n\nElse, if you just need a call into EL3, use PSCI_VERSION or SMCCC_VERSION. Dont base tests on TSP as this test will just skip for most useful build configs.",
      "parentUuid": "78d52387_dea8b6b5",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d42ab5e_9facdc56",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2022-11-22T21:34:05Z",
      "side": 1,
      "message": "You can use SMCCC_VERSION or an unimplemented SMC call and ignore the error.",
      "parentUuid": "b6c42d0c_01ff5869",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ac805b5_040f7200",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-23T11:07:02Z",
      "side": 1,
      "message": "I want to go inter SEL2 or higher with this test, staying in EL3 might not require it to context switch registers and the test could produce a false negative. Isn\u0027t SMCCC_VERSION handled in EL3 only?\n\nAs for FF-A, sure sounds good. Shouldn\u0027t we document this somewhere? I couldn\u0027t find in TF-A docs a hint TSP will disappear. This problem is sure to come up again and whoever is next will go through the same \"don\u0027t do this\" dance.",
      "parentUuid": "9d42ab5e_9facdc56",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ad1d3865_2abd8020",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-11-23T11:56:12Z",
      "side": 1,
      "message": "Yup, I agree, is it more useful to go into secure world and then come back. This expectation to use FF-A calls for tests involving Secure world should be conveyed to the TF-A team appropriately.",
      "parentUuid": "1ac805b5_040f7200",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7eacd4b9_3ee38447",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-29T14:11:09Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "ad1d3865_2abd8020",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f275a5f3_7e6be0a3",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-10-31T14:58:44Z",
      "side": 1,
      "message": "A better way to test would be for Secure World to test that PMU is disabled when in Secure. The asset to protect is Secure world timings and hence that would be a better test. The PMU counter should always count up from current values, but should not rely on the count being the same even after return from Secure world.",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "825e70bc_1703f194",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-14T12:05:23Z",
      "side": 1,
      "message": "There is already such a test, test_pmu_leakage (from NS though), so this is strictly out of scope for my tests. This test is only for NS behaviour. \n\nWhy shouldn\u0027t the count remain the same after an SMC? EL3 does a context switch so there is no reason for the counters to change. This test only checks this.",
      "parentUuid": "f275a5f3_7e6be0a3",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e15f46ef_c2ce0bff",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-11-22T17:48:32Z",
      "side": 1,
      "message": "So the assumption made for this test is wrong I think. TSP (secure world) doesn\u0027t save PMU counters today , nor does EL3. \n\nThe test description should read:\n\n\"Check if entering/exiting secure world preserves all PMU config registers and the PMU counters can only be \u003e\u003d values prior to calling EL3.\n\nThe PMU counters remains the same , even after making the Secure call , because the Secure world/EL3 didn\u0027t touch those regs.\"",
      "parentUuid": "825e70bc_1703f194",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b62a7dc_f232dbe9",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-23T11:07:02Z",
      "side": 1,
      "message": "I don\u0027t think the assumption is wrong. The test checks something along the lines of \"NS should not have its counters altered regardless of what EL3 and secure world are up to\". Sure, they don\u0027t use the PMU (and as a consequence don\u0027t save anything) _today_ but that assumption could change in future and this test tries to capture that. NS should be able to rely on counters and configurations remaining the same regardless of whether secure world decides to save them and use the PMU or disable the PMU entirely.\n\nThe check for \u003e\u003d of the value is kind of an implementation detail of the test and shouldn\u0027t be in the header comment. It arises from the fact that the leakage tests guarantee that counters won\u0027t increase due to counting in secure world and the PMU allows for some inaccuracy in the count itself. If EL3 was to do something funny with those registers it only makes sense for them to reduce in value (i.e. probably get reset to zero). I could try to bound the allowed value but I\u0027m not sure how well that will play with the allowed inaccuracy.",
      "parentUuid": "e15f46ef_c2ce0bff",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "64eaf9d5_f6525ee9",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-11-23T11:56:12Z",
      "side": 1,
      "message": "hmm, I would say the description can be enhanced (which is what I suggested in the comment). The \"entering/exiting secure world preserves all PMU registers\" is not accurate obviously the counters are still expected count up by the test. EL3 may or may not save and restore PMU counters. It may even allow PMU counters to run in the secure world if the platform needs to be debugged. It depends on security model but as far the test is concerned, these are the expectations:\n1. the config is expected to remain the same\n2. the counters should never count backwards (ie end count should \u003e\u003d start_count).\n\nHence the ask to firm up the description. The \u003e\u003d statement PMU counters is also needed because the counter value are expected to go up,",
      "parentUuid": "3b62a7dc_f232dbe9",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3f696058_25765ae5",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-29T14:11:09Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "64eaf9d5_f6525ee9",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a76170d5_df1feff5",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 247,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-10-31T14:58:44Z",
      "side": 1,
      "message": "Not sure how this count will match start count ? The count is running when entering EL3 and similarly when returning.",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a5b6dc58_1b43553f",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 247,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-14T12:05:23Z",
      "side": 1,
      "message": "It doesn\u0027t check the counter. Rather, it checks the counter (and PMU in general) _config_ which should remain the same across a context switch.\n\nThis bit doesn\u0027t care if the counter is running in EL3/secure world themselves (and test_pmu_leakage asserts that it is not), it only checks that entering EL3 with the counters running doesn\u0027t do anything funny. If it happens that EL3 disables the PMU for itself then there are enough instructions before and after it to bump the counters.",
      "parentUuid": "a76170d5_df1feff5",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "636faac1_54358916",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 247,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-11-22T17:48:32Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "a5b6dc58_1b43553f",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "684a2985_2abe1751",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 257,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-10-31T14:58:44Z",
      "side": 1,
      "message": "Is this the overflow case ?",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "130c0508_7f674d2f",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 257,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-14T12:05:23Z",
      "side": 1,
      "message": "No, this is the case where EL3 did not preserve counters. This checks only that EL3 didn\u0027t reset these registers to 0. I\u0027m not sure if there\u0027s a consistent way to check for any change in general here.",
      "parentUuid": "684a2985_2abe1751",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ebfef5f8_44103e62",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 257,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-11-22T17:48:32Z",
      "side": 1,
      "message": "The comments here were a bit confusing to me. PMU counters can overflow but it may not happen for  this test case. I think what you need to check if that count after SMC call is \u003e\u003d count before SMC.\n\n/* test-pmu-leakage guarantee no increase so they could only be reset */ \u003d\u003d\u003e \n\n/* Ensure counter values before SMC is \u003c\u003d the values after SMC. If EL3 or secure world has reset or corrupted the counters, we can expect this check to fail. We do not consider the overflow case here */\n\nif (ctr_start[[0] \u003e ctr_end[0])",
      "parentUuid": "130c0508_7f674d2f",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ed4c17e0_ab3f4841",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 257,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-23T11:07:02Z",
      "side": 1,
      "message": "I\u0027m still not sure why overflow is relevant? My test is small enough for the 32 (or 64) bit counters to never get anywhere even close to that and pmu leakage tests assert that secure world won\u0027t increase them, so overflow is not a thing to worry about. The check you describe is the check I perform? It\u0027s just inverted as that\u0027s the failing case. After the check ctr_start \u003c ctr_end will be true.\n\nI can still expand the comment on when we expect to fail.",
      "parentUuid": "ebfef5f8_44103e62",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "256fc412_a12a6c35",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 257,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-11-23T11:56:12Z",
      "side": 1,
      "message": "The test is small enough, but it is making a call into the secure world which may take unbounded time to complete. The overflow is unlikely but worth of mention in the comment to make clear your expectation of the check.\n\nIn my comment , I changed the \u003e\u003d to just \u003e as it could be possible that the SMC returned very quickly that the counter did not increment at all. So the suggested change :\n\nif (ctr_start[0] \u003e\u003d ctr_end[0])  \u003d\u003d\u003e if (ctr_start[0] \u003e ctr_end[0])",
      "parentUuid": "ed4c17e0_ab3f4841",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5938f05d_96dce22c",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 257,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-29T14:11:09Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "256fc412_a12a6c35",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c8414be5_09425733",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 265,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-10-31T14:58:44Z",
      "side": 1,
      "message": "Is this is the overflow case ?",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "87f0eb1c_b911fec8",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 265,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2022-11-14T12:05:23Z",
      "side": 1,
      "message": "Same, but for the other counter.",
      "parentUuid": "c8414be5_09425733",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0a8d2eae_34fbed82",
        "filename": "tftf/tests/extensions/pmuv3/test_pmuv3.c",
        "patchSetId": 4
      },
      "lineNbr": 265,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2022-11-22T17:48:32Z",
      "side": 1,
      "message": "see comments above.",
      "parentUuid": "87f0eb1c_b911fec8",
      "revId": "fbad109358ec2635eb10974de1e84fe9b8d9c88e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}